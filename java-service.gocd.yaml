---
    format_version: 2
    # common:
    #   build: &build
    #     - build:
    #         clean_workspace: true
    #         jobs:
    #           docker-build:
    #             tasks:
    #               - exec:
    #                   command: bash
    #                   arguments:
    #                     - -c
    #                     - docker build -t api_test_base . -f ${DOCKERFILE_NAME}

    pipelines:
      java-app:
        group: dockers
        lock_behavior: unlockWhenFinished
        label_template: "${java-app}"
        materials:
          java-app:
            git: https://github.com/aakacenoks/ci_pipelines.git
            branch: main
            shallow_clone: true
            auto_update: true
        stages: 
          - build:
              clean_workspace: true
              jobs:
                build:
                  tasks:
                    - exec:
                        command: bash
                        arguments:
                          - -c
                          - "Building java application"
          - deploy-dev:
              clean_workspace: true
              jobs:
                build:
                  tasks:
                    - exec:
                        command: bash
                        arguments:
                          - -c
                          - "Devployment on DEV"
          - test-dev:
              clean_workspace: true
              jobs:
                build:
                  tasks:
                    - exec:
                        command: bash
                        arguments:
                          - -c
                          - "Testing on DEV"
          - deploy-int:
              clean_workspace: true
              jobs:
                build:
                  tasks:
                    - exec:
                        command: bash
                        arguments:
                          - -c
                          - "Devployment on INT"
          - test-int:
              clean_workspace: true
              jobs:
                build:
                  tasks:
                    - exec:
                        command: bash
                        arguments:
                          - -c
                          - "Testing on PRD"
          - deploy-prd:
              clean_workspace: true
              jobs:
                build:
                  tasks:
                    - exec:
                        command: bash
                        arguments:
                          - -c
                          - "Devployment on PRD"
          - test-prd:
              clean_workspace: true
              jobs:
                build:
                  tasks:
                    - exec:
                        command: bash
                        arguments:
                          - -c
                          - "Testing on PRD"